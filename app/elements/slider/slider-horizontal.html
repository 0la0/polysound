<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="slider-horizontal">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        margin-top: 40px;
        width: 100%;
        height: 50px;
        border: 2px solid black;
        cursor: default;
      }
      #tracker {
        display: block;
        background-color: black;
        width: 0%;
        height: 100%;
      }
    </style>

    <div id="tracker"></div>

  </template>

  <script>
    (function() {
      'use strict';

      let MyBehavior = {};

      class SliderHorizontal {

        get behaviors() {
          return [MyBehavior];
        }

        beforeRegister() {
          this.is = 'slider-horizontal';

          this.properties = {
            sliderValue: {
              type: Number,
              notify: true,
              observer: '_valueChanged'
            }
          };

          this.listeners = {
            'down': '_userEvent',
            'track': '_userEvent'
          };

        }

        ready() {
          this.tracker = this.$$('#tracker');

          window.addEventListener('resize', (event) => {
            this.boundingClientRect = this.getBoundingClientRect();
          });
        }

        attached() {
          this.boundingClientRect = this.getBoundingClientRect();
          this._valueChanged(this.sliderValue);
        }

        detached() {}

        attributeChanged() {}

        _userEvent (event) {
          var normalizedPosition = event.detail.x - this.boundingClientRect.left;
          var newValue = normalizedPosition / this.boundingClientRect.width;

          newValue = Math.max(0, Math.min(newValue, 1));
          this.sliderValue = newValue;
        }

        _valueChanged (newValue) {
          var percentString = 'width: ' + (newValue * 100) + '%';
          if (this.tracker) {
            this.tracker.style.cssText = percentString;
          }
        }

      }

      Polymer(SliderHorizontal);
    })();
  </script>

</dom-module>
