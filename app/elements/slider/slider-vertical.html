<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="slider-vertical">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        height: 100%;
        border: 2px solid black;
        cursor: default;
      }
      #tracker {
        display: block;
        position: absolute;
        bottom: 0;
        background-color: black;
        width: 100%;
        height: 0%;
      }
    </style>

    <div id="tracker"></div>

  </template>

  <script>
    (function() {
      'use strict';

      let MyBehavior = {};

      class SliderVertical {

        get behaviors() {
          return [MyBehavior];
        }

        beforeRegister() {
          this.is = 'slider-vertical';

          this.properties = {
            sliderValue: {
              type: Number,
              notify: true,
              observer: '_valueChanged'
            },
            lowerBound: {
              type: Number,
              value: 0
            },
            upperBound: {
              type: Number,
              value: 1
            }
          };

          this.listeners = {
            'down': '_userEvent',
            'track': '_userEvent'
          };

        }

        ready() {
          this.tracker = this.$$('#tracker');
          this.valueRange = this.upperBound - this.lowerBound;

          window.addEventListener('resize', (event) => {
            this.boundingClientRect = this.getBoundingClientRect();
          });
        }

        attached() {
          this.boundingClientRect = this.getBoundingClientRect();
          this._valueChanged(this.sliderValue);
        }

        detached() {}

        attributeChanged() {}

        _userEvent (event) {
          var normalizedPosition = event.detail.y - this.boundingClientRect.top;
          var normalValue = normalizedPosition / this.boundingClientRect.height;
          normalValue = Math.max(0, Math.min(normalValue, 1));
          var realValue = normalValue * this.valueRange;
          this.sliderValue = this.upperBound - realValue;
        }

        _valueChanged (newValue) {
          var normalValue = (newValue - this.lowerBound) / this.valueRange;
          var percentString = 'height: ' + (normalValue * 100) + '%';
          if (this.tracker) {
            this.tracker.style.cssText = percentString;
          }
        }


      }

      Polymer(SliderVertical);
    })();
  </script>

</dom-module>
