<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="sampler-loader">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        font-size: 12px;
      }
      .sampler-loader {
        margin-top: 10px;
      }
    </style>

    <div class="samper-loader">
      <dropdown-element
        list-data="[[listData]]"
        callback-handler="[[callbackHandler]]"
        label="[[activeSampleLabel]]">
      </dropdown-element>
    </div>


  </template>

  <script>
    (function() {
      'use strict';

      class SamplerLoader {

        beforeRegister() {
          this.is = 'sampler-loader';

          this.properties = {
            parentEventHandler: {
              type: Object
            }
          };

          this.listeners = {
            down: '_handleClick'
          };

        }

        ready() {}
        attached() {
          this.dropdownElement = this.$$('dropdown-element');
          this.activeSampleLabel = 'Load Sample';

          this.callbackHandler = {
            execute: (selectionString) => {
              this.parentEventHandler.newSample(selectionString);
              this.activeSampleLabel = getSampleName(selectionString);
            }
          };
        }
        detached() {}
        attributeChanged() {}

        _handleClick (event) {
          if (event.detail.sourceEvent.srcElement !== this.$.dropdownElement) {
            //rehydrate list
            this.listData = Array.from(app.audio.sampleMap.keys());
            return;
          }
        }
      }
      Polymer(SamplerLoader);

      function getSampleName (originalName) {
        let tokens = originalName.split('/');
        let name = tokens[1] || originalName;
        return name.split('.')[0];
      }

    })();
  </script>

</dom-module>
