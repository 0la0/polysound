<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="sampler-loader">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
      }
      .sampler-loader {}
      .sampler-loader__label {
        line-height: 36px;
        font-size: 12px;
      }
      .sampler-loader__dropdown {
        display: none;
      }
      .sampler-loader__dropdown--active {
        display: block;
      }
    </style>

    <div class="samper-loader">
      <p class="sampler-loader__label">{{activeSampleLabel}}</p>
      <dropdown-list
        class="sampler-loader__dropdown"
        list-data="[[listData]]"
        callback-handler="[[callbackHandler]]">
      <dropdown-list>
    </div>


  </template>

  <script>
    (function() {
      'use strict';

      class SamplerLoader {

        beforeRegister() {
          this.is = 'sampler-loader';

          this.properties = {
            parentEventHandler: {
              type: Object
            }
          };

          this.listeners = {
            down: '_handleClick'
          };

        }

        ready() {}
        attached() {
          this.dropdownIsShown = false;
          this.dropdownList = this.$$('dropdown-list');
          this.activeSampleLabel = 'Load Sample';

          this.callbackHandler = {
            execute: (selectionString) => {
              this.parentEventHandler.newSample(selectionString);
              this.activeSampleLabel = getSampleName(selectionString);
            }
          };
        }
        detached() {}
        attributeChanged() {}

        _handleClick (event) {
          this.dropdownIsShown = !this.dropdownIsShown;

          if (this.dropdownIsShown) {
            //rehydrate list
            this.listData = Array.from(app.audio.sampleMap.keys());
            this.dropdownList.classList.add('sampler-loader__dropdown--active');
          }
          else {
            this.dropdownList.classList.remove('sampler-loader__dropdown--active');
          }
        }
      }
      Polymer(SamplerLoader);

      function getSampleName (originalName) {
        let tokens = originalName.split('/');
        let name = tokens[1] || originalName;
        return name.split('.')[0];
      }

    })();
  </script>

</dom-module>
